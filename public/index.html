<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursor Tracker with Chat</title>
    <style>
        body { margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        .cursor { position: absolute; width: 10px; height: 10px; background: red; border-radius: 50%; }
        .player-list { position: fixed; top: 10px; right: 10px; background: white; padding: 10px; border: 1px solid black; }
        .player-name { margin-bottom: 5px; }
        #join-form { display: flex; flex-direction: column; align-items: center; margin-top: 20px; }
        .chat { position: fixed; bottom: 10px; left: 10px; width: 300px; background: white; border: 1px solid black; padding: 10px; }
        .messages { height: 200px; overflow-y: scroll; margin-bottom: 10px; }
        .message { margin-bottom: 5px; }
    </style>
</head>
<body>
    <div id="join-form">
        <input type="text" id="room-input" placeholder="Room Name" />
        <input type="text" id="name-input" placeholder="Your Name" />
        <button id="join-button">Join Room</button>
    </div>
    <div class="player-list" id="player-list"></div>
    <div class="chat" id="chat" style="display:none;">
        <div class="messages" id="messages"></div>
        <input type="text" id="message-input" placeholder="Type a message" />
        <button id="send-button">Send</button>
    </div>
    <script>
        let ws;
        let cursors = {};
        let name;
        let room;

        document.getElementById('join-button').addEventListener('click', () => {
            room = document.getElementById('room-input').value;
            name = document.getElementById('name-input').value;

            if (room && name) {
                ws = new WebSocket(`wss://${window.location.host}`);
                ws.onopen = () => {
                    ws.send(JSON.stringify({ action: 'join', payload: { room, name } }));
                    document.getElementById('join-form').style.display = 'none';
                    document.getElementById('chat').style.display = 'block';
                };

                ws.onmessage = (event) => {
                    const { action, payload } = JSON.parse(event.data);

                    switch (action) {
                        case 'updatePlayers':
                            updatePlayerList(payload);
                            break;
                        case 'move':
                            updateCursor(payload);
                            break;
                        case 'removeCursor':
                            removeCursor(payload);
                            break;
                        case 'chat':
                            addMessage(payload);
                            break;
                        default:
                            break;
                    }
                };

                document.addEventListener('mousemove', (e) => {
                    const data = { x: e.clientX, y: e.clientY };
                    ws.send(JSON.stringify({ action: 'move', payload: data }));
                });

                document.getElementById('send-button').addEventListener('click', () => {
                    const message = document.getElementById('message-input').value;
                    if (message) {
                        ws.send(JSON.stringify({ action: 'chat', payload: { room, name, message } }));
                        document.getElementById('message-input').value = '';
                    }
                });
            }
        });

        function updatePlayerList(players) {
            const playerList = document.getElementById('player-list');
            playerList.innerHTML = '';
            players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-name';
                playerDiv.textContent = player;
                playerList.appendChild(playerDiv);
            });
        }

        function updateCursor({ name, x, y }) {
            if (!cursors[name]) {
                const cursor = document.createElement('div');
                cursor.classList.add('cursor');
                const label = document.createElement('span');
                label.classList.add('label');
                label.textContent = name;
                cursor.appendChild(label);
                document.body.appendChild(cursor);
                cursors[name] = cursor;
            }

            const cursor = cursors[name];
            cursor.style.left = `${x}px`;
            cursor.style.top = `${y}px`;
        }

        function removeCursor({ name }) {
            if (cursors[name]) {
                document.body.removeChild(cursors[name]);
                delete cursors[name];
            }
        }

        function addMessage({ date, name, message }) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.textContent = `[${date}] ${name}: ${message}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>
